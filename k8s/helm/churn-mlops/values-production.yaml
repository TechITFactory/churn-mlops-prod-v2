# Production environment values
# Override default values for production deployment

image:
  tag: "v1.0.0"  # Will be updated by CD pipeline
  pullPolicy: IfNotPresent

# Persistent Volume Claim configuration
pvc:
  name: churn-mlops-data-prod
  accessModes:
    - ReadWriteOnce
  size: 50Gi

api:
  replicaCount: 3
  
  ingress:
    enabled: true
    className: "nginx"
    annotations:
      cert-manager.io/cluster-issuer: "letsencrypt-prod"
      nginx.ingress.kubernetes.io/rate-limit: "1000"
      nginx.ingress.kubernetes.io/limit-rps: "100"
      nginx.ingress.kubernetes.io/ssl-redirect: "true"
    hosts:
      - host: churn-api.example.com
        paths:
          - path: /
            pathType: Prefix
    tls:
      - secretName: churn-api-prod-tls
        hosts:
          - churn-api.example.com
  
  resources:
    limits:
      cpu: 2000m
      memory: 2Gi
    requests:
      cpu: 1000m
      memory: 1Gi
  
  autoscaling:
    enabled: true
    minReplicas: 3
    maxReplicas: 20
    targetCPUUtilizationPercentage: 60
    targetMemoryUtilizationPercentage: 70
  
  env:
    - name: CHURN_MLOPS_CONFIG
      value: /app/config/config.yaml
    - name: LOG_LEVEL
      value: INFO
    - name: ENVIRONMENT
      value: production
    - name: MAX_WORKERS
      value: "4"

ml:
  resources:
    limits:
      cpu: 4000m
      memory: 8Gi
    requests:
      cpu: 2000m
      memory: 4Gi

# Production job schedules
batchScore:
  enabled: true
  schedule: "0 2 * * *"  # Daily at 2 AM
  successfulJobsHistoryLimit: 5
  failedJobsHistoryLimit: 3

retrain:
  enabled: true
  schedule: "0 3 * * 0"  # Weekly on Sunday at 3 AM
  successfulJobsHistoryLimit: 5
  failedJobsHistoryLimit: 3

driftMonitoring:
  enabled: true
  schedule: "0 */6 * * *"  # Every 6 hours
  successfulJobsHistoryLimit: 5
  failedJobsHistoryLimit: 3

persistence:
  enabled: true
  size: 50Gi
  volumes:
    data:
      size: 50Gi
    artifacts:
      size: 100Gi

podDisruptionBudget:
  enabled: true
  minAvailable: 2

networkPolicy:
  enabled: true

prometheus:
  enabled: true
  serviceMonitor:
    enabled: true
    interval: 15s
    scrapeTimeout: 10s

# Production affinity rules for high availability
affinity:
  podAntiAffinity:
    requiredDuringSchedulingIgnoredDuringExecution:
      - labelSelector:
          matchExpressions:
            - key: app.kubernetes.io/name
              operator: In
              values:
                - churn-mlops
        topologyKey: kubernetes.io/hostname
  nodeAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        preference:
          matchExpressions:
            - key: node-role.kubernetes.io/worker
              operator: In
              values:
                - "true"
